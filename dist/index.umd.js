(function(S,R){typeof exports=="object"&&typeof module<"u"?R(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],R):(S=typeof globalThis<"u"?globalThis:S||self,R(S.VueKeyboardTrap={},S.Vue))})(this,function(S,R){"use strict";function H(o){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const a in o)if(a!=="default"){const u=Object.getOwnPropertyDescriptor(o,a);Object.defineProperty(r,a,u.get?u:{enumerable:!0,get:()=>o[a]})}}return r.default=o,Object.freeze(r)}const B=H(R);function G(o){const r={name:"kbd-trap",focusableSelector:[":focus"].concat(["a[href]","area[href]","audio[controls]","video[controls]","iframe","[tabindex]:not(slot)",'[contenteditable]:not([contenteditable="false"])',"details > summary:first-of-type"].map(s=>`${s}:not([tabindex^="-"])`)).concat(['input:not([type="hidden"]):not(fieldset[disabled] input)',"select:not(fieldset[disabled] select)","textarea:not(fieldset[disabled] textarea)","button:not(fieldset[disabled] button)",'[class*="focusable"]'].map(s=>`${s}:not([disabled]):not([tabindex^="-"])`)).concat(['input:not([type="hidden"])',"select","textarea","button"].map(s=>`fieldset[disabled]:not(fieldset[disabled] fieldset) > legend ${s}:not([disabled]):not([tabindex^="-"])`)).join(","),rovingSkipSelector:['input:not([disabled]):not([type="button"]):not([type="checkbox"]):not([type="file"]):not([type="image"]):not([type="radio"]):not([type="reset"]):not([type="submit"])',"select:not([disabled])","select:not([disabled]) *","textarea:not([disabled])",'[contenteditable]:not([contenteditable="false"])','[contenteditable]:not([contenteditable="false"]) *'].join(","),gridSkipSelector:[":not([disabled])",':not([tabindex^="-"])'].join(""),autofocusSelector:['[autofocus]:not([autofocus="false"])','[data-autofocus]:not([data-autofocus="false"])'].map(s=>`${s}:not([disabled])`).join(","),trapTabIndex:-9999,...o},a=r.name.toLocaleLowerCase().split(/[^a-z0-9]+/).filter(s=>s.length>0).map(s=>`${s[0].toLocaleUpperCase()}${s.slice(1)}`).join("");if(r.datasetName===void 0&&(r.datasetName=`v${a}`),r.datasetNameActive=`${r.datasetName}Active`,r.datasetNamePreventRefocus=`${r.datasetName}PreventRefocus`,typeof window>"u")return r;const u=document.createElement("span");u.dataset[r.datasetName]="";const c=u.getAttributeNames()[0];return r.datasetNameSelector=`[${c}]`,r.datasetNameSelectorRovingHorizontal=`[${c}~="roving"][${c}~="horizontal"],[${c}~="roving"]:not([${c}~="vertical"])`,r.datasetNameSelectorRovingVertical=`[${c}~="roving"][${c}~="vertical"],[${c}~="roving"]:not([${c}~="horizontal"])`,r.datasetNameRow=`${r.datasetName}Row`,r.datasetNameRowSelector=s=>`:focus,[${c}-row~="${s}"]${r.gridSkipSelector},[${c}-row~="*"]${r.gridSkipSelector}`,r.datasetNameCol=`${r.datasetName}Col`,r.datasetNameColSelector=s=>`:focus,[${c}-col~="${s}"]${r.gridSkipSelector},[${c}-col~="*"]${r.gridSkipSelector}`,r}function J(){return!0}function P(o,r=!1){const{left:a,top:u}=o.getBoundingClientRect(),c=document.elementFromPoint(a,u);if(o.contains(c)===!0)return!0;if(r===!0||typeof o.scrollIntoView!="function")return c===null;const s=[];let t=o.parentElement;for(;t!==null;)s.push([t,t.scrollLeft,t.scrollTop]),t=t.parentElement;o.scrollIntoView();const w=P(o,!0);for(let v=s.length-1;v>=0;v-=1){const[e,n,i]=s[v];e.scrollLeft=n,e.scrollTop=i}return w}function y(o,r=J){return o===null||typeof o.focus!="function"||r(o)!==!0?!1:(o.focus(),o===document.activeElement)}const Q=/(\d+)/;function F(o){const r=Q.exec(o);return r===null?"":r[1]}function z(o,r){const a=(o&&o!==r&&o.parentElement||r).closest('[dir="rtl"],[dir="ltr"]');return a&&a.matches('[dir="rtl"]')}let b=null;function T(o,r){b!==o&&(o!==null&&(o.dataset[r.datasetNameActive]="",o.__vKbdTrapActiveClean=()=>{delete o.dataset[r.datasetNameActive],o.__vKbdTrapActiveClean=void 0}),b!==null&&typeof b.__vKbdTrapActiveClean=="function"&&b.__vKbdTrapActiveClean(),b=o)}function O(o){const r=(o||{}).__vKbdTrap;return r===Object(r)?r:null}function M(o,r,a,u){r===!0?(delete o.dataset[u.datasetName],o.tabIndex===u.trapTabIndex&&o.removeAttribute("tabindex")):(o.dataset[u.datasetName]=Object.keys(a.modifiers).filter(c=>a.modifiers[c]===!0).join(" "),o.tabIndex<0&&o.getAttribute("tabindex")===null&&o.matches("dialog")===!1&&(o.tabIndex=u.trapTabIndex))}function D(o,r){const a=G(o),u=(t,{value:w,modifiers:v})=>{const e={disable:w===!1,modifiers:v,focusTarget:null,relatedFocusTarget:null,bind(){t.__vKbdTrap=e,t.addEventListener("keydown",e.trap),t.addEventListener("focusin",e.activate),t.addEventListener("focusout",e.deactivate),t.addEventListener("pointerdown",e.overwiteFocusTarget,{passive:!0}),e.disable===!1&&M(t,e.disable,e,a)},unbind(){delete t.__vKbdTrap,t.removeEventListener("keydown",e.trap),t.removeEventListener("focusin",e.activate),t.removeEventListener("focusout",e.deactivate),t.removeEventListener("pointerdown",e.overwiteFocusTarget),M(t,!0,e,a)},activate(n){if(e.disable===!0||n.__vKbdTrap===!0)return;n.__vKbdTrap=!0;const i=n.relatedTarget;b!==t&&(i===null||i.closest(a.datasetNameSelector)!==t)&&(T(t,a),e.relatedFocusTarget=i,(i===null||i.dataset[a.datasetNamePreventRefocus]===void 0||t.contains(i)===!1)&&requestAnimationFrame(()=>{e.refocus(e.modifiers.roving!==!0)}))},deactivate(n){if(e.disable===!0||n.__vKbdTrap===!0)return;n.__vKbdTrap=!0;const i=n.relatedTarget;b===t&&(i===null||i.closest(a.datasetNameSelector)!==t)&&(e.focusTarget=n.target,T(null,a))},trap(n){if(e.disable===!0||n.__vKbdTrap===!0)return;const{code:i,shiftKey:V}=n,{activeElement:g}=document;if(i==="Escape"){if(n.__vKbdTrap=!0,b===t){if(e.focusTarget=g,e.modifiers.escexits===!0){T(t.parentElement===null?null:t.parentElement.closest(a.datasetNameSelector),a);const l=O(b);l!==null&&l.refocus();return}if(e.modifiers.escrefocus===!0&&y(e.relatedFocusTarget)===!0)return;T(null,a)}else T(t,a);return}if(b!==t)return;n.__vKbdTrap=!0;let m=0,N=l=>l,A=!1,_=!1;if(e.modifiers.roving===!0){const l=g.matches(a.rovingSkipSelector);if(i!=="Tab"&&l===!0)return;if(i==="Tab")l===!1&&e.modifiers.tabinside!==!0?(A=t.parentElement.closest(a.datasetNameSelector),A!==null&&(n.__vKbdTrap=void 0),V===!0?(m=1,N=(d,f)=>f):(m=-1,N=()=>0)):m=V===!0?-1:1;else if(i==="Home")m=1,N=(d,f)=>f;else if(i==="End")m=-1,N=()=>0;else if(t.parentElement!==null&&(e.modifiers.vertical===!0&&e.modifiers.horizontal!==!0&&(i==="ArrowLeft"||i==="ArrowRight")||e.modifiers.horizontal===!0&&e.modifiers.vertical!==!0&&(i==="ArrowUp"||i==="ArrowDown"))){const d=t.parentElement.closest(e.modifiers.vertical===!0?a.datasetNameSelectorRovingHorizontal:a.datasetNameSelectorRovingVertical);d!==null&&(A=d,n.__vKbdTrap=void 0,i===(z(g,t)===!0?"ArrowRight":"ArrowLeft")||i==="ArrowUp"?(m=1,N=(f,h)=>h):(m=-1,N=()=>0))}else(e.modifiers.vertical===!0||e.modifiers.horizontal!==!0)&&(i==="ArrowUp"?(m=-1,_="v"):i==="ArrowDown"&&(m=1,_="v")),(e.modifiers.vertical!==!0||e.modifiers.horizontal===!0)&&(i==="ArrowLeft"?(m=-1,_="h"):i==="ArrowRight"&&(m=1,_="h"),m!==0&&_==="h"&&z(g,t)===!0&&(m*=-1))}else i==="Tab"&&(m=V===!0?-1:1);if(m===0)return;A===!1?n.preventDefault():(e.focusTarget=g,e.focusTarget.dataset[a.datasetNamePreventRefocus]="",requestAnimationFrame(()=>{e.focusTarget&&delete e.focusTarget.dataset[a.datasetNamePreventRefocus]}));let p=[];if(_!==!1){let l;if(e.modifiers.grid===!0){const d=F(g.dataset[a.datasetNameRow]),f=F(g.dataset[a.datasetNameCol]),h=_==="v"?a.datasetNameColSelector(f):a.datasetNameRowSelector(d);p=Array.from(t.querySelectorAll(h)),l=new WeakMap(p.map(k=>{const x=F(k.dataset[a.datasetNameRow]),K=F(k.dataset[a.datasetNameCol]);let E;return _==="v"?(x!==d||K===f)&&(E=1e3*x+1*K):(K!==f||x===d)&&(E=1e3*K+1*x),[k,E]}))}else if(t.matches('[role="grid"]')===!0&&g.matches('[role="row"] [role="gridcell"]')){const d=Array.from(t.querySelectorAll('[role="row"]')),f=new WeakMap,h=d.map((q,I)=>{const C=Array.from(q.querySelectorAll('[role="gridcell"]'));return C.forEach((L,ee)=>{f.set(L,[I+1,ee+1])}),C}),k=g.closest('[role="row"]'),x=d.indexOf(k)+1,K=h[x-1].indexOf(g)+1,{focusableSelector:E}=a;p=Array.from(t.querySelectorAll(E)),l=new WeakMap(p.map(q=>{const[I,C]=f.get(q)||[null,null];let L;return _==="v"?C===K&&(L=1*I):I===x&&(L=1*C),[q,L]}))}l!==void 0&&(p=p.filter(d=>l.get(d)!==void 0),p.sort((d,f)=>l.get(d)-l.get(f)))}if(p.length===0){const{focusableSelector:l}=a;if(p=Array.from(t.querySelectorAll(l)),v.indexorder===!0){const d=new WeakMap(p.map(f=>[f,Math.max(f.tabIndex||0,0)]));p.sort((f,h)=>d.get(f)-d.get(h))}t.matches(l)&&p.unshift(t)}const j=p.length-1;let $=N(p.indexOf(g),j);for(let l=0;l<j;l+=1)if($+=m,$<0?$=j:$>j&&($=0),y(p[$])===!0){A!==!1&&T(A,a);return}},overwiteFocusTarget(n){e.disable===!1&&n.__vKbdTrap!==!0&&(n.__vKbdTrap=!0,e.focusTarget=n.target)},refocus(n){return e.disable===!1&&b===t&&e.focusTarget&&e.focusTarget.closest(a.datasetNameSelector)===t?e.focusTarget.tabIndex===a.trapTabIndex||e.focusTarget.matches("dialog")===!0?e.modifiers.autofocus===!0&&y(t.querySelector(a.autofocusSelector))===!0||y(t.querySelector(a.focusableSelector))===!0||y(e.focusTarget)===!0:n===!0?!1:y(e.focusTarget)===!0||y(t.querySelector(a.focusableSelector))===!0:!1},autofocus(){requestAnimationFrame(()=>{e.disable===!1&&y(t.querySelector(a.autofocusSelector),P)===!1&&y(t.querySelector(a.focusableSelector),P)})}};e.bind(),v.autofocus===!0&&e.autofocus()},c=(t,{value:w,modifiers:v})=>{const e=O(t);if(e!==null){const n=w===!1;e.modifiers=v,M(t,n,e,a),b===t&&(n===!0?T(null,a):t.dataset[a.datasetNameActive]=""),e.disable!==n&&(e.disable=n,v.autofocus===!0?e.autofocus():n===!1&&b!==t&&t.contains(document.activeElement)===!0&&T(t,a))}else r!==void 0?u(t,{value:w,modifiers:v}):b===t&&T(null,a)},s=t=>{const w=O(t);w!==null&&w.unbind(),b===t&&T(null,a)};return r!==void 0?r({name:a.name,directive:{beforeMount:u,updated:c,unmounted:s,getSSRProps(){}}}):{name:a.name,directive:{bind:u,update:c,unbind:s}}}const{markRaw:X,version:Y}=B,U=Y.indexOf("2.")===0?void 0:X,W={install(o,r){const{name:a,directive:u}=D(r,U);o.directive(a,u)}},Z=o=>D(o,U);S.VueKeyboardTrapDirectiveFactory=Z,S.VueKeyboardTrapDirectivePlugin=W,S.default=W,Object.defineProperties(S,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map

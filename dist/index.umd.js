(function(S,R){typeof exports=="object"&&typeof module<"u"?R(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],R):(S=typeof globalThis<"u"?globalThis:S||self,R(S.VueKeyboardTrap={},S.Vue))})(this,function(S,R){"use strict";function H(o){const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const r in o)if(r!=="default"){const u=Object.getOwnPropertyDescriptor(o,r);Object.defineProperty(a,r,u.get?u:{enumerable:!0,get:()=>o[r]})}}return a.default=o,Object.freeze(a)}const B=H(R);function G(o){const a={name:"kbd-trap",focusableSelector:[":focus"].concat(["a[href]","area[href]","audio[controls]","video[controls]","iframe","[tabindex]:not(slot)",'[contenteditable]:not([contenteditable="false"])',"details > summary:first-of-type"].map(s=>`${s}:not([tabindex^="-"])`)).concat(['input:not([type="hidden"]):not(fieldset[disabled] input)',"select:not(fieldset[disabled] select)","textarea:not(fieldset[disabled] textarea)","button:not(fieldset[disabled] button)",'[class*="focusable"]'].map(s=>`${s}:not([disabled]):not([tabindex^="-"])`)).concat(['input:not([type="hidden"])',"select","textarea","button"].map(s=>`fieldset[disabled]:not(fieldset[disabled] fieldset) > legend ${s}:not([disabled]):not([tabindex^="-"])`)).join(","),rovingSkipSelector:['input:not([disabled]):not([type="button"]):not([type="checkbox"]):not([type="file"]):not([type="image"]):not([type="radio"]):not([type="reset"]):not([type="submit"])',"select:not([disabled])","select:not([disabled]) *","textarea:not([disabled])",'[contenteditable]:not([contenteditable="false"])','[contenteditable]:not([contenteditable="false"]) *'].join(","),gridSkipSelector:[":not([disabled])",':not([tabindex^="-"])'].join(""),autofocusSelector:['[autofocus]:not([autofocus="false"])','[data-autofocus]:not([data-autofocus="false"])'].map(s=>`${s}:not([disabled])`).join(","),trapTabIndex:-9999,...o},r=a.name.toLocaleLowerCase().split(/[^a-z0-9]+/).filter(s=>s.length>0).map(s=>`${s[0].toLocaleUpperCase()}${s.slice(1)}`).join("");if(a.datasetName===void 0&&(a.datasetName=`v${r}`),a.datasetNameActive=`${a.datasetName}Active`,a.datasetNamePreventRefocus=`${a.datasetName}PreventRefocus`,typeof window>"u")return a;const u=document.createElement("span");u.dataset[a.datasetName]="";const c=u.getAttributeNames()[0];return a.datasetNameSelector=`[${c}]`,a.datasetNameSelectorRovingHorizontal=`[${c}~="roving"][${c}~="horizontal"],[${c}~="roving"]:not([${c}~="vertical"])`,a.datasetNameSelectorRovingVertical=`[${c}~="roving"][${c}~="vertical"],[${c}~="roving"]:not([${c}~="horizontal"])`,a.datasetNameRow=`${a.datasetName}Row`,a.datasetNameRowSelector=s=>`:focus,[${c}-row~="${s}"]${a.gridSkipSelector},[${c}-row~="*"]${a.gridSkipSelector}`,a.datasetNameCol=`${a.datasetName}Col`,a.datasetNameColSelector=s=>`:focus,[${c}-col~="${s}"]${a.gridSkipSelector},[${c}-col~="*"]${a.gridSkipSelector}`,a}function J(){return!0}function P(o,a=!1){const{left:r,top:u}=o.getBoundingClientRect(),c=document.elementFromPoint(r,u);if(o.contains(c)===!0)return!0;if(a===!0||typeof o.scrollIntoView!="function")return c===null;const s=[];let e=o.parentElement;for(;e!==null;)s.push([e,e.scrollLeft,e.scrollTop]),e=e.parentElement;o.scrollIntoView();const w=P(o,!0);for(let v=s.length-1;v>=0;v-=1){const[t,n,i]=s[v];t.scrollLeft=n,t.scrollTop=i}return w}function y(o,a=J){return o===null||typeof o.focus!="function"||a(o)!==!0?!1:(o.focus(),o===document.activeElement)}const Q=/(\d+)/;function F(o){const a=Q.exec(o);return a===null?"":a[1]}function z(o,a){const r=(o&&o!==a&&o.parentElement||a).closest('[dir="rtl"],[dir="ltr"]');return r&&r.matches('[dir="rtl"]')}let b=null;function T(o,a){b!==o&&(o!==null&&(o.dataset[a.datasetNameActive]="",o.__vKbdTrapActiveClean=()=>{delete o.dataset[a.datasetNameActive],o.__vKbdTrapActiveClean=void 0}),b!==null&&typeof b.__vKbdTrapActiveClean=="function"&&b.__vKbdTrapActiveClean(),b=o)}function O(o){const a=(o||{}).__vKbdTrap;return a===Object(a)?a:null}function M(o,a,r,u){a===!0?(delete o.dataset[u.datasetName],o.tabIndex===u.trapTabIndex&&o.removeAttribute("tabindex")):(o.dataset[u.datasetName]=Object.keys(r.modifiers).filter(c=>r.modifiers[c]===!0).join(" "),o.tabIndex<0&&o.getAttribute("tabindex")===null&&(o.tabIndex=u.trapTabIndex))}function D(o,a){const r=G(o),u=(e,{value:w,modifiers:v})=>{const t={disable:w===!1,modifiers:v,focusTarget:null,relatedFocusTarget:null,bind(){e.__vKbdTrap=t,e.addEventListener("keydown",t.trap),e.addEventListener("focusin",t.activate),e.addEventListener("focusout",t.deactivate),e.addEventListener("pointerdown",t.overwiteFocusTarget,{passive:!0}),t.disable===!1&&M(e,t.disable,t,r)},unbind(){delete e.__vKbdTrap,e.removeEventListener("keydown",t.trap),e.removeEventListener("focusin",t.activate),e.removeEventListener("focusout",t.deactivate),e.removeEventListener("pointerdown",t.overwiteFocusTarget),M(e,!0,t,r)},activate(n){if(t.disable===!0||n.__vKbdTrap===!0)return;n.__vKbdTrap=!0;const i=n.relatedTarget;b!==e&&(i===null||i.closest(r.datasetNameSelector)!==e)&&(T(e,r),t.relatedFocusTarget=i,(i===null||i.dataset[r.datasetNamePreventRefocus]===void 0||e.contains(i)===!1)&&requestAnimationFrame(()=>{t.refocus(t.modifiers.roving!==!0)}))},deactivate(n){if(t.disable===!0||n.__vKbdTrap===!0)return;n.__vKbdTrap=!0;const i=n.relatedTarget;b===e&&(i===null||i.closest(r.datasetNameSelector)!==e)&&(t.focusTarget=n.target,T(null,r))},trap(n){if(t.disable===!0||n.__vKbdTrap===!0)return;const{code:i,shiftKey:V}=n,{activeElement:g}=document;if(i==="Escape"){if(n.__vKbdTrap=!0,b===e){if(t.focusTarget=g,t.modifiers.escexits===!0){T(e.parentElement===null?null:e.parentElement.closest(r.datasetNameSelector),r);const l=O(b);l!==null&&l.refocus();return}if(t.modifiers.escrefocus===!0&&y(t.relatedFocusTarget)===!0)return;T(null,r)}else T(e,r);return}if(b!==e)return;n.__vKbdTrap=!0;let m=0,N=l=>l,h=!1,_=!1;if(t.modifiers.roving===!0){const l=g.matches(r.rovingSkipSelector);if(i!=="Tab"&&l===!0)return;if(i==="Tab")l===!1&&t.modifiers.tabinside!==!0?(h=e.parentElement.closest(r.datasetNameSelector),h!==null&&(n.__vKbdTrap=void 0),V===!0?(m=1,N=(d,f)=>f):(m=-1,N=()=>0)):m=V===!0?-1:1;else if(i==="Home")m=1,N=(d,f)=>f;else if(i==="End")m=-1,N=()=>0;else if(e.parentElement!==null&&(t.modifiers.vertical===!0&&t.modifiers.horizontal!==!0&&(i==="ArrowLeft"||i==="ArrowRight")||t.modifiers.horizontal===!0&&t.modifiers.vertical!==!0&&(i==="ArrowUp"||i==="ArrowDown"))){const d=e.parentElement.closest(t.modifiers.vertical===!0?r.datasetNameSelectorRovingHorizontal:r.datasetNameSelectorRovingVertical);d!==null&&(h=d,n.__vKbdTrap=void 0,i===(z(g,e)===!0?"ArrowRight":"ArrowLeft")||i==="ArrowUp"?(m=1,N=(f,x)=>x):(m=-1,N=()=>0))}else(t.modifiers.vertical===!0||t.modifiers.horizontal!==!0)&&(i==="ArrowUp"?(m=-1,_="v"):i==="ArrowDown"&&(m=1,_="v")),(t.modifiers.vertical!==!0||t.modifiers.horizontal===!0)&&(i==="ArrowLeft"?(m=-1,_="h"):i==="ArrowRight"&&(m=1,_="h"),m!==0&&_==="h"&&z(g,e)===!0&&(m*=-1))}else i==="Tab"&&(m=V===!0?-1:1);if(m===0)return;h===!1?n.preventDefault():(t.focusTarget=g,t.focusTarget.dataset[r.datasetNamePreventRefocus]="",requestAnimationFrame(()=>{t.focusTarget&&delete t.focusTarget.dataset[r.datasetNamePreventRefocus]}));let p=[];if(_!==!1){let l;if(t.modifiers.grid===!0){const d=F(g.dataset[r.datasetNameRow]),f=F(g.dataset[r.datasetNameCol]),x=_==="v"?r.datasetNameColSelector(f):r.datasetNameRowSelector(d);p=Array.from(e.querySelectorAll(x)),l=new WeakMap(p.map(k=>{const A=F(k.dataset[r.datasetNameRow]),K=F(k.dataset[r.datasetNameCol]);let E;return _==="v"?(A!==d||K===f)&&(E=1e3*A+1*K):(K!==f||A===d)&&(E=1e3*K+1*A),[k,E]}))}else if(e.matches('[role="grid"]')===!0&&g.matches('[role="row"] [role="gridcell"]')){const d=Array.from(e.querySelectorAll('[role="row"]')),f=new WeakMap,x=d.map((q,I)=>{const C=Array.from(q.querySelectorAll('[role="gridcell"]'));return C.forEach((L,ee)=>{f.set(L,[I+1,ee+1])}),C}),k=g.closest('[role="row"]'),A=d.indexOf(k)+1,K=x[A-1].indexOf(g)+1,{focusableSelector:E}=r;p=Array.from(e.querySelectorAll(E)),l=new WeakMap(p.map(q=>{const[I,C]=f.get(q)||[null,null];let L;return _==="v"?C===K&&(L=1*I):I===A&&(L=1*C),[q,L]}))}l!==void 0&&(p=p.filter(d=>l.get(d)!==void 0),p.sort((d,f)=>l.get(d)-l.get(f)))}if(p.length===0){const{focusableSelector:l}=r;if(p=Array.from(e.querySelectorAll(l)),v.indexorder===!0){const d=new WeakMap(p.map(f=>[f,Math.max(f.tabIndex||0,0)]));p.sort((f,x)=>d.get(f)-d.get(x))}e.matches(l)&&p.unshift(e)}const j=p.length-1;let $=N(p.indexOf(g),j);for(let l=0;l<j;l+=1)if($+=m,$<0?$=j:$>j&&($=0),y(p[$])===!0){h!==!1&&T(h,r);return}},overwiteFocusTarget(n){t.disable===!1&&n.__vKbdTrap!==!0&&(n.__vKbdTrap=!0,t.focusTarget=n.target)},refocus(n){return t.disable===!1&&b===e&&t.focusTarget&&t.focusTarget.closest(r.datasetNameSelector)===e?t.focusTarget.tabIndex===r.trapTabIndex?t.modifiers.autofocus===!0&&y(e.querySelector(r.autofocusSelector))===!0||y(e.querySelector(r.focusableSelector))===!0||y(t.focusTarget)===!0:n===!0?!1:y(t.focusTarget)===!0||y(e.querySelector(r.focusableSelector))===!0:!1},autofocus(){requestAnimationFrame(()=>{t.disable===!1&&y(e.querySelector(r.autofocusSelector),P)===!1&&y(e.querySelector(r.focusableSelector),P)})}};t.bind(),v.autofocus===!0&&t.autofocus()},c=(e,{value:w,modifiers:v})=>{const t=O(e);if(t!==null){const n=w===!1;t.modifiers=v,M(e,n,t,r),b===e&&(n===!0?T(null,r):e.dataset[r.datasetNameActive]=""),t.disable!==n&&(t.disable=n,v.autofocus===!0?t.autofocus():n===!1&&b!==e&&e.contains(document.activeElement)===!0&&T(e,r))}else a!==void 0?u(e,{value:w,modifiers:v}):b===e&&T(null,r)},s=e=>{const w=O(e);w!==null&&w.unbind(),b===e&&T(null,r)};return a!==void 0?a({name:r.name,directive:{beforeMount:u,updated:c,unmounted:s,getSSRProps(){}}}):{name:r.name,directive:{bind:u,update:c,unbind:s}}}const{markRaw:X,version:Y}=B,U=Y.indexOf("2.")===0?void 0:X,W={install(o,a){const{name:r,directive:u}=D(a,U);o.directive(r,u)}},Z=o=>D(o,U);S.VueKeyboardTrapDirectiveFactory=Z,S.VueKeyboardTrapDirectivePlugin=W,S.default=W,Object.defineProperties(S,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=index.umd.js.map

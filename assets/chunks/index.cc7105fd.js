import{aj as V}from"./framework.929dd95f.js";function D(o){const r={name:"kbd-trap",focusableSelector:[":focus"].concat(["a[href]","area[href]","audio[controls]","video[controls]","iframe","[tabindex]:not(slot)",'[contenteditable]:not([contenteditable="false"])',"details > summary:first-of-type"].map(i=>`${i}:not([tabindex^="-"])`)).concat(['input:not([type="hidden"]):not(fieldset[disabled] input)',"select:not(fieldset[disabled] select)","textarea:not(fieldset[disabled] textarea)","button:not(fieldset[disabled] button)",'[class*="focusable"]'].map(i=>`${i}:not([disabled]):not([tabindex^="-"])`)).concat(['input:not([type="hidden"])',"select","textarea","button"].map(i=>`fieldset[disabled]:not(fieldset[disabled] fieldset) > legend ${i}:not([disabled]):not([tabindex^="-"])`)).join(","),rovingSkipSelector:['input:not([disabled]):not([type="button"]):not([type="checkbox"]):not([type="file"]):not([type="image"]):not([type="radio"]):not([type="reset"]):not([type="submit"])',"select:not([disabled])","select:not([disabled]) *","textarea:not([disabled])",'[contenteditable]:not([contenteditable="false"])','[contenteditable]:not([contenteditable="false"]) *'].join(","),gridSkipSelector:[":not([disabled])",':not([tabindex^="-"])'].join(""),autofocusSelector:['[autofocus]:not([autofocus="false"])','[data-autofocus]:not([data-autofocus="false"])'].map(i=>`${i}:not([disabled])`).join(","),trapTabIndex:-9999,...o},a=r.name.toLocaleLowerCase().split(/[^a-z0-9]+/).filter(i=>i.length>0).map(i=>`${i[0].toLocaleUpperCase()}${i.slice(1)}`).join("");if(r.datasetName===void 0&&(r.datasetName=`v${a}`),r.datasetNameActive=`${r.datasetName}Active`,r.datasetNamePreventRefocus=`${r.datasetName}PreventRefocus`,typeof window>"u")return r;const p=document.createElement("span");p.dataset[r.datasetName]="";const c=p.getAttributeNames()[0];return r.datasetNameSelector=`[${c}]`,r.datasetNameSelectorRovingHorizontal=`[${c}~="roving"][${c}~="horizontal"],[${c}~="roving"]:not([${c}~="vertical"])`,r.datasetNameSelectorRovingVertical=`[${c}~="roving"][${c}~="vertical"],[${c}~="roving"]:not([${c}~="horizontal"])`,r.datasetNameRow=`${r.datasetName}Row`,r.datasetNameRowSelector=i=>`:focus,[${c}-row~="${i}"]${r.gridSkipSelector},[${c}-row~="*"]${r.gridSkipSelector}`,r.datasetNameCol=`${r.datasetName}Col`,r.datasetNameColSelector=i=>`:focus,[${c}-col~="${i}"]${r.gridSkipSelector},[${c}-col~="*"]${r.gridSkipSelector}`,r}function U(){return!0}function P(o,r=!1){const{left:a,top:p}=o.getBoundingClientRect(),c=document.elementFromPoint(a,p);if(o.contains(c)===!0)return!0;if(r===!0||typeof o.scrollIntoView!="function")return c===null;const i=[];let e=o.parentElement;for(;e!==null;)i.push([e,e.scrollLeft,e.scrollTop]),e=e.parentElement;o.scrollIntoView();const T=P(o,!0);for(let v=i.length-1;v>=0;v-=1){const[t,n,s]=i[v];t.scrollLeft=n,t.scrollTop=s}return T}function x(o,r=U){return o===null||typeof o.focus!="function"||r(o)!==!0?!1:(o.focus(),o===document.activeElement)}const W=/(\d+)/;function I(o){const r=W.exec(o);return r===null?"":r[1]}function M(o,r){const a=(o&&o!==r&&o.parentElement||r).closest('[dir="rtl"],[dir="ltr"]');return a&&a.matches('[dir="rtl"]')}let b=null;function S(o,r){b!==o&&(o!==null&&(o.dataset[r.datasetNameActive]="",o.__vKbdTrapActiveClean=()=>{delete o.dataset[r.datasetNameActive],o.__vKbdTrapActiveClean=void 0}),b!==null&&typeof b.__vKbdTrapActiveClean=="function"&&b.__vKbdTrapActiveClean(),b=o)}function j(o){const r=(o||{}).__vKbdTrap;return r===Object(r)?r:null}function z(o,r,a,p){r===!0?(delete o.dataset[p.datasetName],o.tabIndex===p.trapTabIndex&&o.removeAttribute("tabindex")):(o.dataset[p.datasetName]=Object.keys(a.modifiers).filter(c=>a.modifiers[c]===!0).join(" "),o.tabIndex<0&&o.getAttribute("tabindex")===null&&(o.tabIndex=p.trapTabIndex))}function H(o,r){const a=D(o),p=(e,{value:T,modifiers:v})=>{const t={disable:T===!1,modifiers:v,focusTarget:null,relatedFocusTarget:null,bind(){e.__vKbdTrap=t,e.addEventListener("keydown",t.trap),e.addEventListener("focusin",t.activate),e.addEventListener("focusout",t.deactivate),e.addEventListener("pointerdown",t.overwiteFocusTarget,{passive:!0}),t.disable===!1&&z(e,t.disable,t,a)},unbind(){delete e.__vKbdTrap,e.removeEventListener("keydown",t.trap),e.removeEventListener("focusin",t.activate),e.removeEventListener("focusout",t.deactivate),e.removeEventListener("pointerdown",t.overwiteFocusTarget),z(e,!0,t,a)},activate(n){if(t.disable===!0||n.__vKbdTrap===!0)return;n.__vKbdTrap=!0;const s=n.relatedTarget;b!==e&&(s===null||s.closest(a.datasetNameSelector)!==e)&&(S(e,a),t.relatedFocusTarget=s,(s===null||s.dataset[a.datasetNamePreventRefocus]===void 0||e.contains(s)===!1)&&requestAnimationFrame(()=>{t.refocus(t.modifiers.roving!==!0)}))},deactivate(n){if(t.disable===!0||n.__vKbdTrap===!0)return;n.__vKbdTrap=!0;const s=n.relatedTarget;b===e&&(s===null||s.closest(a.datasetNameSelector)!==e)&&(t.focusTarget=n.target,S(null,a))},trap(n){if(t.disable===!0||n.__vKbdTrap===!0)return;const{code:s,shiftKey:q}=n,{activeElement:g}=document;if(s==="Escape"){if(n.__vKbdTrap=!0,b===e){if(t.focusTarget=g,t.modifiers.escexits===!0){S(e.parentElement===null?null:e.parentElement.closest(a.datasetNameSelector),a);const l=j(b);l!==null&&l.refocus();return}if(t.modifiers.escrefocus===!0&&x(t.relatedFocusTarget)===!0)return;S(null,a)}else S(e,a);return}if(b!==e)return;n.__vKbdTrap=!0;let f=0,N=l=>l,y=!1,w=!1;if(t.modifiers.roving===!0){const l=g.matches(a.rovingSkipSelector);if(s!=="Tab"&&l===!0)return;if(s==="Tab")l===!1&&t.modifiers.tabinside!==!0?(y=e.parentElement.closest(a.datasetNameSelector),y!==null&&(n.__vKbdTrap=void 0),q===!0?(f=1,N=(u,d)=>d):(f=-1,N=()=>0)):f=q===!0?-1:1;else if(s==="Home")f=1,N=(u,d)=>d;else if(s==="End")f=-1,N=()=>0;else if(e.parentElement!==null&&(t.modifiers.vertical===!0&&t.modifiers.horizontal!==!0&&(s==="ArrowLeft"||s==="ArrowRight")||t.modifiers.horizontal===!0&&t.modifiers.vertical!==!0&&(s==="ArrowUp"||s==="ArrowDown"))){const u=e.parentElement.closest(t.modifiers.vertical===!0?a.datasetNameSelectorRovingHorizontal:a.datasetNameSelectorRovingVertical);u!==null&&(y=u,n.__vKbdTrap=void 0,s===(M(g,e)===!0?"ArrowRight":"ArrowLeft")||s==="ArrowUp"?(f=1,N=(d,A)=>A):(f=-1,N=()=>0))}else(t.modifiers.vertical===!0||t.modifiers.horizontal!==!0)&&(s==="ArrowUp"?(f=-1,w="v"):s==="ArrowDown"&&(f=1,w="v")),(t.modifiers.vertical!==!0||t.modifiers.horizontal===!0)&&(s==="ArrowLeft"?(f=-1,w="h"):s==="ArrowRight"&&(f=1,w="h"),f!==0&&w==="h"&&M(g,e)===!0&&(f*=-1))}else s==="Tab"&&(f=q===!0?-1:1);if(f===0)return;y===!1?n.preventDefault():(t.focusTarget=g,t.focusTarget.dataset[a.datasetNamePreventRefocus]="",requestAnimationFrame(()=>{t.focusTarget&&delete t.focusTarget.dataset[a.datasetNamePreventRefocus]}));let m=[];if(w!==!1){let l;if(t.modifiers.grid===!0){const u=I(g.dataset[a.datasetNameRow]),d=I(g.dataset[a.datasetNameCol]),A=w==="v"?a.datasetNameColSelector(d):a.datasetNameRowSelector(u);m=Array.from(e.querySelectorAll(A)),l=new WeakMap(m.map(R=>{const _=I(R.dataset[a.datasetNameRow]),$=I(R.dataset[a.datasetNameCol]);let E;return w==="v"?(_!==u||$===d)&&(E=1e3*_+1*$):($!==d||_===u)&&(E=1e3*$+1*_),[R,E]}))}else if(e.matches('[role="grid"]')===!0&&g.matches('[role="row"] [role="gridcell"]')){const u=Array.from(e.querySelectorAll('[role="row"]')),d=new WeakMap,A=u.map((L,F)=>{const k=Array.from(L.querySelectorAll('[role="gridcell"]'));return k.forEach((C,O)=>{d.set(C,[F+1,O+1])}),k}),R=g.closest('[role="row"]'),_=u.indexOf(R)+1,$=A[_-1].indexOf(g)+1,{focusableSelector:E}=a;m=Array.from(e.querySelectorAll(E)),l=new WeakMap(m.map(L=>{const[F,k]=d.get(L)||[null,null];let C;return w==="v"?k===$&&(C=1*F):F===_&&(C=1*k),[L,C]}))}l!==void 0&&(m=m.filter(u=>l.get(u)!==void 0),m.sort((u,d)=>l.get(u)-l.get(d)))}if(m.length===0){const{focusableSelector:l}=a;if(m=Array.from(e.querySelectorAll(l)),v.indexorder===!0){const u=new WeakMap(m.map(d=>[d,Math.max(d.tabIndex||0,0)]));m.sort((d,A)=>u.get(d)-u.get(A))}e.matches(l)&&m.unshift(e)}const K=m.length-1;let h=N(m.indexOf(g),K);for(let l=0;l<K;l+=1)if(h+=f,h<0?h=K:h>K&&(h=0),x(m[h])===!0){y!==!1&&S(y,a);return}},overwiteFocusTarget(n){t.disable===!1&&n.__vKbdTrap!==!0&&(n.__vKbdTrap=!0,t.focusTarget=n.target)},refocus(n){return t.disable===!1&&b===e&&t.focusTarget&&t.focusTarget.closest(a.datasetNameSelector)===e?t.focusTarget.tabIndex===a.trapTabIndex?t.modifiers.autofocus===!0&&x(e.querySelector(a.autofocusSelector))===!0||x(e.querySelector(a.focusableSelector))===!0||x(t.focusTarget)===!0:n===!0?!1:x(t.focusTarget)===!0||x(e.querySelector(a.focusableSelector))===!0:!1},autofocus(){requestAnimationFrame(()=>{t.disable===!1&&x(e.querySelector(a.autofocusSelector),P)===!1&&x(e.querySelector(a.focusableSelector),P)})}};t.bind(),v.autofocus===!0&&t.autofocus()},c=(e,{value:T,modifiers:v})=>{const t=j(e);if(t!==null){const n=T===!1;t.modifiers=v,z(e,n,t,a),b===e&&(n===!0?S(null,a):e.dataset[a.datasetNameActive]=""),t.disable!==n&&(t.disable=n,v.autofocus===!0?t.autofocus():n===!1&&b!==e&&e.contains(document.activeElement)===!0&&S(e,a))}else r!==void 0?p(e,{value:T,modifiers:v}):b===e&&S(null,a)},i=e=>{const T=j(e);T!==null&&T.unbind(),b===e&&S(null,a)};return r!==void 0?r({name:a.name,directive:{beforeMount:p,updated:c,unmounted:i,getSSRProps(){}}}):{name:a.name,directive:{bind:p,update:c,unbind:i}}}const{markRaw:B,version:G}=V,J=G.indexOf("2.")===0?void 0:B,X=o=>H(o,J);export{X as V};

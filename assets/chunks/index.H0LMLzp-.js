import{am as V}from"./framework.QXqgAoi7.js";function D(o){const r={name:"kbd-trap",focusableSelector:[":focus"].concat(["a[href]","area[href]","audio[controls]","video[controls]","iframe","[tabindex]:not(slot)",'[contenteditable]:not([contenteditable="false"])',"details > summary:first-of-type"].map(i=>`${i}:not([tabindex^="-"])`)).concat(['input:not([type="hidden"]):not(fieldset[disabled] input)',"select:not(fieldset[disabled] select)","textarea:not(fieldset[disabled] textarea)","button:not(fieldset[disabled] button)",'[class*="focusable"]'].map(i=>`${i}:not([disabled]):not([tabindex^="-"])`)).concat(['input:not([type="hidden"])',"select","textarea","button"].map(i=>`fieldset[disabled]:not(fieldset[disabled] fieldset) > legend ${i}:not([disabled]):not([tabindex^="-"])`)).join(","),rovingSkipSelector:['input:not([disabled]):not([type="button"]):not([type="checkbox"]):not([type="file"]):not([type="image"]):not([type="radio"]):not([type="reset"]):not([type="submit"])',"select:not([disabled])","select:not([disabled]) *","textarea:not([disabled])",'[contenteditable]:not([contenteditable="false"])','[contenteditable]:not([contenteditable="false"]) *'].join(","),gridSkipSelector:[":not([disabled])",':not([tabindex^="-"])'].join(""),autofocusSelector:['[autofocus]:not([autofocus="false"])','[data-autofocus]:not([data-autofocus="false"])'].map(i=>`${i}:not([disabled])`).join(","),trapTabIndex:-9999,...o},a=r.name.toLocaleLowerCase().split(/[^a-z0-9]+/).filter(i=>i.length>0).map(i=>`${i[0].toLocaleUpperCase()}${i.slice(1)}`).join("");if(r.datasetName===void 0&&(r.datasetName=`v${a}`),r.datasetNameActive=`${r.datasetName}Active`,r.datasetNamePreventRefocus=`${r.datasetName}PreventRefocus`,typeof window>"u")return r;const p=document.createElement("span");p.dataset[r.datasetName]="";const c=p.getAttributeNames()[0];return r.datasetNameSelector=`[${c}]`,r.datasetNameSelectorRovingHorizontal=`[${c}~="roving"][${c}~="horizontal"],[${c}~="roving"]:not([${c}~="vertical"])`,r.datasetNameSelectorRovingVertical=`[${c}~="roving"][${c}~="vertical"],[${c}~="roving"]:not([${c}~="horizontal"])`,r.datasetNameRow=`${r.datasetName}Row`,r.datasetNameRowSelector=i=>`:focus,[${c}-row~="${i}"]${r.gridSkipSelector},[${c}-row~="*"]${r.gridSkipSelector}`,r.datasetNameCol=`${r.datasetName}Col`,r.datasetNameColSelector=i=>`:focus,[${c}-col~="${i}"]${r.gridSkipSelector},[${c}-col~="*"]${r.gridSkipSelector}`,r}function U(){return!0}function j(o,r=!1){const{left:a,top:p}=o.getBoundingClientRect(),c=document.elementFromPoint(a,p);if(o.contains(c)===!0)return!0;if(r===!0||typeof o.scrollIntoView!="function")return c===null;const i=[];let t=o.parentElement;for(;t!==null;)i.push([t,t.scrollLeft,t.scrollTop]),t=t.parentElement;o.scrollIntoView();const T=j(o,!0);for(let v=i.length-1;v>=0;v-=1){const[e,n,s]=i[v];e.scrollLeft=n,e.scrollTop=s}return T}function N(o,r=U){return o===null||typeof o.focus!="function"||r(o)!==!0?!1:(o.focus(),o===document.activeElement)}const W=/(\d+)/;function I(o){const r=W.exec(o);return r===null?"":r[1]}function M(o,r){const a=(o&&o!==r&&o.parentElement||r).closest('[dir="rtl"],[dir="ltr"]');return a&&a.matches('[dir="rtl"]')}let b=null;function S(o,r){b!==o&&(o!==null&&(o.dataset[r.datasetNameActive]="",o.__vKbdTrapActiveClean=()=>{delete o.dataset[r.datasetNameActive],o.__vKbdTrapActiveClean=void 0}),b!==null&&typeof b.__vKbdTrapActiveClean=="function"&&b.__vKbdTrapActiveClean(),b=o)}function z(o){const r=(o||{}).__vKbdTrap;return r===Object(r)?r:null}function P(o,r,a,p){r===!0?(delete o.dataset[p.datasetName],o.tabIndex===p.trapTabIndex&&o.removeAttribute("tabindex")):(o.dataset[p.datasetName]=Object.keys(a.modifiers).filter(c=>a.modifiers[c]===!0).join(" "),o.tabIndex<0&&o.getAttribute("tabindex")===null&&o.matches("dialog")===!1&&(o.tabIndex=p.trapTabIndex))}function H(o,r){const a=D(o),p=(t,{value:T,modifiers:v})=>{const e={disable:T===!1,modifiers:v,focusTarget:null,relatedFocusTarget:null,bind(){t.__vKbdTrap=e,t.addEventListener("keydown",e.trap),t.addEventListener("focusin",e.activate),t.addEventListener("focusout",e.deactivate),t.addEventListener("pointerdown",e.overwiteFocusTarget,{passive:!0}),e.disable===!1&&P(t,e.disable,e,a)},unbind(){delete t.__vKbdTrap,t.removeEventListener("keydown",e.trap),t.removeEventListener("focusin",e.activate),t.removeEventListener("focusout",e.deactivate),t.removeEventListener("pointerdown",e.overwiteFocusTarget),P(t,!0,e,a)},activate(n){if(e.disable===!0||n.__vKbdTrap===!0)return;n.__vKbdTrap=!0;const s=n.relatedTarget;b!==t&&(s===null||s.closest(a.datasetNameSelector)!==t)&&(S(t,a),e.relatedFocusTarget=s,(s===null||s.dataset[a.datasetNamePreventRefocus]===void 0||t.contains(s)===!1)&&requestAnimationFrame(()=>{e.refocus(e.modifiers.roving!==!0)}))},deactivate(n){if(e.disable===!0||n.__vKbdTrap===!0)return;n.__vKbdTrap=!0;const s=n.relatedTarget;b===t&&(s===null||s.closest(a.datasetNameSelector)!==t)&&(e.focusTarget=n.target,S(null,a))},trap(n){if(e.disable===!0||n.__vKbdTrap===!0)return;const{code:s,shiftKey:q}=n,{activeElement:g}=document;if(s==="Escape"){if(n.__vKbdTrap=!0,b===t){if(e.focusTarget=g,e.modifiers.escexits===!0){S(t.parentElement===null?null:t.parentElement.closest(a.datasetNameSelector),a);const l=z(b);l!==null&&l.refocus();return}if(e.modifiers.escrefocus===!0&&N(e.relatedFocusTarget)===!0)return;S(null,a)}else S(t,a);return}if(b!==t)return;n.__vKbdTrap=!0;let f=0,x=l=>l,h=!1,w=!1;if(e.modifiers.roving===!0){const l=g.matches(a.rovingSkipSelector);if(s!=="Tab"&&l===!0)return;if(s==="Tab")l===!1&&e.modifiers.tabinside!==!0?(h=t.parentElement.closest(a.datasetNameSelector),h!==null&&(n.__vKbdTrap=void 0),q===!0?(f=1,x=(u,d)=>d):(f=-1,x=()=>0)):f=q===!0?-1:1;else if(s==="Home")f=1,x=(u,d)=>d;else if(s==="End")f=-1,x=()=>0;else if(t.parentElement!==null&&(e.modifiers.vertical===!0&&e.modifiers.horizontal!==!0&&(s==="ArrowLeft"||s==="ArrowRight")||e.modifiers.horizontal===!0&&e.modifiers.vertical!==!0&&(s==="ArrowUp"||s==="ArrowDown"))){const u=t.parentElement.closest(e.modifiers.vertical===!0?a.datasetNameSelectorRovingHorizontal:a.datasetNameSelectorRovingVertical);u!==null&&(h=u,n.__vKbdTrap=void 0,s===(M(g,t)===!0?"ArrowRight":"ArrowLeft")||s==="ArrowUp"?(f=1,x=(d,A)=>A):(f=-1,x=()=>0))}else(e.modifiers.vertical===!0||e.modifiers.horizontal!==!0)&&(s==="ArrowUp"?(f=-1,w="v"):s==="ArrowDown"&&(f=1,w="v")),(e.modifiers.vertical!==!0||e.modifiers.horizontal===!0)&&(s==="ArrowLeft"?(f=-1,w="h"):s==="ArrowRight"&&(f=1,w="h"),f!==0&&w==="h"&&M(g,t)===!0&&(f*=-1))}else s==="Tab"&&(f=q===!0?-1:1);if(f===0)return;h===!1?n.preventDefault():(e.focusTarget=g,e.focusTarget.dataset[a.datasetNamePreventRefocus]="",requestAnimationFrame(()=>{e.focusTarget&&delete e.focusTarget.dataset[a.datasetNamePreventRefocus]}));let m=[];if(w!==!1){let l;if(e.modifiers.grid===!0){const u=I(g.dataset[a.datasetNameRow]),d=I(g.dataset[a.datasetNameCol]),A=w==="v"?a.datasetNameColSelector(d):a.datasetNameRowSelector(u);m=Array.from(t.querySelectorAll(A)),l=new WeakMap(m.map(R=>{const _=I(R.dataset[a.datasetNameRow]),$=I(R.dataset[a.datasetNameCol]);let E;return w==="v"?(_!==u||$===d)&&(E=1e3*_+1*$):($!==d||_===u)&&(E=1e3*$+1*_),[R,E]}))}else if(t.matches('[role="grid"]')===!0&&g.matches('[role="row"] [role="gridcell"]')){const u=Array.from(t.querySelectorAll('[role="row"]')),d=new WeakMap,A=u.map((L,F)=>{const k=Array.from(L.querySelectorAll('[role="gridcell"]'));return k.forEach((C,O)=>{d.set(C,[F+1,O+1])}),k}),R=g.closest('[role="row"]'),_=u.indexOf(R)+1,$=A[_-1].indexOf(g)+1,{focusableSelector:E}=a;m=Array.from(t.querySelectorAll(E)),l=new WeakMap(m.map(L=>{const[F,k]=d.get(L)||[null,null];let C;return w==="v"?k===$&&(C=1*F):F===_&&(C=1*k),[L,C]}))}l!==void 0&&(m=m.filter(u=>l.get(u)!==void 0),m.sort((u,d)=>l.get(u)-l.get(d)))}if(m.length===0){const{focusableSelector:l}=a;if(m=Array.from(t.querySelectorAll(l)),v.indexorder===!0){const u=new WeakMap(m.map(d=>[d,Math.max(d.tabIndex||0,0)]));m.sort((d,A)=>u.get(d)-u.get(A))}t.matches(l)&&m.unshift(t)}const K=m.length-1;let y=x(m.indexOf(g),K);for(let l=0;l<K;l+=1)if(y+=f,y<0?y=K:y>K&&(y=0),N(m[y])===!0){h!==!1&&S(h,a);return}},overwiteFocusTarget(n){e.disable===!1&&n.__vKbdTrap!==!0&&(n.__vKbdTrap=!0,e.focusTarget=n.target)},refocus(n){return e.disable===!1&&b===t&&e.focusTarget&&e.focusTarget.closest(a.datasetNameSelector)===t?e.focusTarget.tabIndex===a.trapTabIndex||e.focusTarget.matches("dialog")===!0?e.modifiers.autofocus===!0&&N(t.querySelector(a.autofocusSelector))===!0||N(t.querySelector(a.focusableSelector))===!0||N(e.focusTarget)===!0:n===!0?!1:N(e.focusTarget)===!0||N(t.querySelector(a.focusableSelector))===!0:!1},autofocus(){requestAnimationFrame(()=>{e.disable===!1&&N(t.querySelector(a.autofocusSelector),j)===!1&&N(t.querySelector(a.focusableSelector),j)})}};e.bind(),v.autofocus===!0&&e.autofocus()},c=(t,{value:T,modifiers:v})=>{const e=z(t);if(e!==null){const n=T===!1;e.modifiers=v,P(t,n,e,a),b===t&&(n===!0?S(null,a):t.dataset[a.datasetNameActive]=""),e.disable!==n&&(e.disable=n,v.autofocus===!0?e.autofocus():n===!1&&b!==t&&t.contains(document.activeElement)===!0&&S(t,a))}else r!==void 0?p(t,{value:T,modifiers:v}):b===t&&S(null,a)},i=t=>{const T=z(t);T!==null&&T.unbind(),b===t&&S(null,a)};return r!==void 0?r({name:a.name,directive:{beforeMount:p,updated:c,unmounted:i,getSSRProps(){}}}):{name:a.name,directive:{bind:p,update:c,unbind:i}}}const{markRaw:B,version:G}=V,J=G.indexOf("2.")===0?void 0:B,X=o=>H(o,J);export{X as V};
